<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title></title>
    </head>
    <body>
        <script type="text/javascript">
            console.log("script");


            function onImageChange(){
                var reader = new FileReader();
                console.log('reader', reader);

                var img1 = document.getElementById('imgId');
                console.log('img1 = ', img1);
                var file = document.getElementById("inputId").files[0];
                console.log('file = ', file);

                reader.onloadend = function(){
                    img1.src = reader.result;
                    console.log('img1.src', img1.src);
                }

                if (file) {
                    //console.log('reader.readAsDataURL(file) = ', reader.readAsDataURL(file));
                    reader.readAsDataURL(file);
                } else {
                    img1.src = "";
                }
            }

            function sub(){
                console.log('sub');
                var formData = new FormData();
                var img1 = document.getElementById('imgId');
                var file = document.getElementById("inputId").files[0];
console.log("file = ", file);
                var img2 = img1.src;
                var json = JSON.stringify(img2);//{"1":"aa", "2":"bb"});
                formData.append('picture', img2, 'test.jpeg');
                //console.log('json', json);
                //console.log('img2 = ', img2);
                fetch('/', {method: 'POST', body: img2})
                //fetch('/', {method: 'POST', headers: {"Content-Type": "multipart/form-data"}, body: formData})
                //fetch('/', {method: 'POST', headers: {"Content-Type": "application/json"}, body: json})
                //.then(res => console.log(res));
/*
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/", true);
                xhr.setRequestHeader("Content-Type", "multipart/form-data");
                xhr.onreadystatechange = function() {//Call a function when the state changes.
                    if(xhr.readyState === 4 && xhr.status === 200) {
                    alert(xhr.responseText);
                    }
                };
                xhr.send(formData);
*/
            };
        </script>


        <form  method="post" enctype="multipart/form-data" >
            <img id="imgId" src="" alt="...">
            <input id="inputId" type="file" name="avatar" >
            <input id="subId" type="submit" value="sub" >
            <button type="button" name="button" onclick="sub()">button1</button>
        </form>

    </body>
</html>
